<!DOCTYPE html><meta charset="utf-8"><div style="position:fixed;left:50%;top:50%;width:200px;">	<div id="process" style="position:absolute;left:-50%;width:0%;height:10px;background-color: #0f0"></div></div><canvas id="canvas" width="960" height="600"></canvas><script type="text/javascript" src="js/d3.js"></script><script type="text/javascript" src="js/paper-full.js"></script><script type="text/javascript" src="data.js"></script><script type="text/paperscript" canvas="canvas">	//背景组	var  BackViewLayer = new Group();	var  BackViewLinkLayer = new Group();	var  BackViewNodeLayer = new Group();	BackViewLayer.addChildren([BackViewLinkLayer,BackViewNodeLayer]);	//BackViewLayer.transform()	//触发配置	var hitOptions = {            segments: true,            stroke: true,            fill: true,            tolerance: 5        },node;	//d3map 数据映射	var NodeMap=d3.map();	//节点	var Node=function (id,imgurl,text,x,y){		var img=this.img=new Image();		var raster=this.raster = new Raster({width:32,height:32});		this.x=x;		this.y=y;		this.links=[];		this.id=id;		this.title = new PointText();		this.img.src=imgurl;		this.img.width=32;		this.img.height=32;		this.img.onload=function(){			console.log("--1--");			raster.set({				image:img,				size:new Size(32,28)			});			raster.translate(0,0);			img=null;			raster=null;		};		this.raster["topo_type"]="node";			console.log("--2--");		this.title.set({			content: text,			fillColor: 'black',			fontSize: 12,			justification: 'center'		});		this.title.translate(0,26);		this.title["topo_type"]="node";		this.constructor({			children: [this.raster,this.title],			fillColor: 'black',			position : new Point(x,y)		});	};	Node.prototype=new Group();	Node.prototype.getXY=function(){console.log(this.position);};	//链接	var Link = function (source,target){		this.source=source;		this.target=target;		this.constructor({			segments: [this.source.position, this.target.position],			strokeColor: '#ccc',			closed: false		});	};	Link.prototype=new Path();	Link.prototype.render=function(){	console.log(this);	console.log(this.source.position +  "_"  + this.target.position);		this.set({			segments: [this.source.position, this.target.position],			strokeColor: '#ccc',			closed: false		})	};	//BackViewLayer.addChild(new Node('1','image/girl.png','window',100,100));	var temp_l=new Path.Line(new Point(1,1),new Point(100,100));	function onMouseDown(event) {            var hitResult = project.hitTest(event.point, hitOptions); 		if (hitResult && hitResult.item["topo_type"]=="node") {			node = hitResult.item;			console.log(hitResult);		}else{			node = BackViewLayer;		} 	};	function onMouseDrag(event) {            if (node["topo_type"]=="node") {                node.parent.position += event.delta;				node.parent.links.forEach(function(d){				d.render();				});            }else{                node.position += event.delta;            }	};	window["Topo"]={		addNode:function(id,img,text,x,y){			var node=new Node(id,img,text,x,y);			NodeMap.set(id,node);			BackViewNodeLayer.addChild(node);		},		addLink:function(sourceid,targetid){			var link=new Link(NodeMap.get(sourceid),NodeMap.get(targetid));			NodeMap.get(sourceid).links.push(link);			NodeMap.get(targetid).links.push(link);			link.render();			BackViewLinkLayer.addChild(link);		}	};</script><script>	var n = 20;	var nodes = d3.range(n * n).map(function(i) {		return {			index: i		};	});	var links = [];	for (var y = 0; y < n; ++y) {		for (var x = 0; x < n; ++x) {			if (y > 0) links.push({source: (y - 1) * n + x, target: y * n + x});			if (x > 0) links.push({source: y * n + (x - 1), target: y * n + x});		}	}	//----------------	var worker = new Worker("worker.js");	worker.postMessage({		nodes: data.nodes,		links: data.links,		width: 1280,		height: 1024	});	worker.onmessage = function(event) {		switch (event.data.type) {			case "tick": return ticked(event.data);			case "end": return ended(event.data);		}	};	function ticked(data) {		var progress = data.progress;		d3.select("#process").style("width",100 * progress + "%");	};	function ended(data) {		d3.select("#process").style("display","none");		data.nodes.forEach(function(d,i){			Topo.addNode(d.id, d.imgurl, d.id , d.x, d.y);		});		data.links.forEach(function(d,i){			Topo.addLink(d.source.id, d.target.id);		});	}</script>